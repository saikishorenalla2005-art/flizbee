<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flizbee - Dynamic Grocery Store</title>
<style>
  :root { --primary:#FFB400; --dark:#0b1220; --card:#fff; --radius:12px; }
  * { box-sizing:border-box; }
  body { margin:0; font-family:Arial,sans-serif; background:#f6f7fb; color:var(--dark); }
  header { background:var(--primary); padding:16px; display:flex; justify-content:space-between; align-items:center; position:sticky; top:0; z-index:100; }
  .brand { font-weight:bold; font-size:24px; }
  .search { display:flex; gap:8px; align-items:center; }
  .search input { padding:8px 12px; border-radius:8px; border:none; width:250px; font-size:14px; }
  .search button { padding:8px 12px; border:none; border-radius:8px; background:#081224; color:#fff; cursor:pointer; font-weight:bold; }
  .container { max-width:1400px; margin:0 auto; padding:16px; }
  
  .products {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap:20px;
    margin-top:20px;
  }
  .product-card {
    background: var(--card);
    border-radius: var(--radius);
    padding:16px;
    cursor:pointer;
    border:1px solid rgba(11,18,32,0.03);
    text-align:center;
    transition:0.2s;
    height:400px;
    display:flex;
    flex-direction:column;
    justify-content:space-between;
  }
  .product-card img {
    width:100%;
    height:220px;
    object-fit:contain;
    border-radius:8px;
    margin-bottom:10px;
  }
  .product-title { font-weight:700; font-size:16px; margin:6px 0 4px; }
  .price { font-weight:800; font-size:16px; margin-bottom:6px; }

  .modal, .cart-modal { position:fixed; inset:0; display:none; background:rgba(0,0,0,0.5); align-items:center; justify-content:center; padding:16px; z-index:200; }
  .modal.open, .cart-modal.open { display:flex; }
  .modal-content, .cart-content { background:#fff; border-radius:12px; padding:20px; max-width:600px; width:100%; max-height:90vh; overflow:auto; }
  .close { float:right; cursor:pointer; font-weight:bold; font-size:20px; }
  
  .cart { position:fixed; bottom:16px; right:16px; background:var(--primary); color:#081224; padding:14px 18px; border-radius:999px; cursor:pointer; font-weight:bold; z-index:150; }
  .cart-item { display:flex; align-items:center; gap:12px; margin:12px 0; border-bottom:1px solid #eee; padding-bottom:6px; }
  .cart-item img { width:60px; height:60px; object-fit:contain; border-radius:6px; }
  .cart-item-details { flex:1; text-align:left; font-size:14px; }
  .cart-item-controls button { margin:0 2px; padding:4px 8px; cursor:pointer; font-size:13px; border-radius:6px; background:#FFB400; border:none; }
  button:hover { opacity:0.9; }
</style>
</head>
<body>

<header>
  <div class="brand">Flizbee</div>
  <div class="search">
    <input id="search" placeholder="Search products...">
    <button id="searchBtn">Search</button>
  </div>
</header>

<div class="container">
  <div class="products" id="products"></div>
</div>

<div class="cart" id="cartBtn">Cart (0)</div>

<!-- Product Modal -->
<div class="modal" id="productModal">
  <div class="modal-content">
    <span class="close" id="closeModal">×</span>
    <div id="modalBody"></div>
  </div>
</div>

<!-- Cart Modal -->
<div class="cart-modal" id="cartModal">
  <div class="cart-content">
    <span class="close" id="closeCart">×</span>
    <h3>Cart</h3>
    <div id="cartItems">Your cart is empty.</div>
    <p><b>Total: ₹<span id="cartTotal">0</span></b></p>
    <button onclick="checkout()">Checkout</button>
  </div>
</div>

<script>
let products = []; // Will be fetched from backend
const productsDiv = document.getElementById('products');
const modal = document.getElementById('productModal');
const modalBody = document.getElementById('modalBody');
const closeModal = document.getElementById('closeModal');
const cartBtn = document.getElementById('cartBtn');
const cartModal = document.getElementById('cartModal');
const closeCart = document.getElementById('closeCart');
const cartItemsDiv = document.getElementById('cartItems');
const cartTotalSpan = document.getElementById('cartTotal');
const searchInput = document.getElementById('search');
const searchBtn = document.getElementById('searchBtn');

let cart = [];

// Render products
function renderProducts(list) {
  productsDiv.innerHTML = '';
  if(list.length === 0){
    productsDiv.innerHTML = '<p>No products found.</p>';
    return;
  }
  list.forEach(p => {
    const card = document.createElement('div');
    card.className = 'product-card';
    card.innerHTML = `
      <img src='${p.img}' alt='${p.name}'>
      <div class='product-title'>${p.name}</div>
      <div class='price'>₹${p.price}</div>
    `;
    card.addEventListener('click', () => showProductModal(p));
    productsDiv.appendChild(card);
  });
}

// Product modal
function showProductModal(product) {
  modalBody.innerHTML = `
    <h3>${product.name}</h3>
    <img src='${product.img}' style='width:100%;border-radius:8px;margin:10px 0;'>
    <p>${product.description}</p>
    <p><b>Price: ₹${product.price}</b></p>
    Quantity: <input type="number" id="modalQty" value="1" min="1" style="width:50px">
    <div style="margin-top:10px;">
      <button onclick='addToCart(${product.id}, parseInt(document.getElementById("modalQty").value))'>Add to Cart</button>
      <button onclick='buyNow(${product.id}, parseInt(document.getElementById("modalQty").value))'>Buy Now</button>
    </div>
  `;
  modal.classList.add('open');
}

closeModal.addEventListener('click', () => modal.classList.remove('open'));

// Search products
function searchProducts() {
  const query = searchInput.value.toLowerCase();
  renderProducts(products.filter(p => p.name.toLowerCase().includes(query)));
}
searchBtn.addEventListener('click', searchProducts);
searchInput.addEventListener('keypress', e => { if(e.key==='Enter') searchProducts(); });

// Cart functions
function addToCart(id, qty = 1){
  const item = products.find(p => p.id === id);
  const existing = cart.find(c => c.id === id);
  if(existing){
    existing.qty += qty;
  } else {
    cart.push({...item, qty});
  }
  updateCart();
  modal.classList.remove('open');
}

function buyNow(id, qty){
  addToCart(id, qty);
  alert(`Proceeding to payment for ₹${cart.reduce((a,b)=>a+b.price*b.qty,0)}!`);
  cart = [];
  updateCart();
  cartModal.classList.remove('open');
}

function updateCart(){
  cartItemsDiv.innerHTML = '';
  if(cart.length === 0){
    cartItemsDiv.innerHTML = 'Your cart is empty.';
  }
  let total = 0;
  cart.forEach((item, idx) => {
    total += item.price * item.qty;
    const div = document.createElement('div');
    div.className = 'cart-item';
    div.innerHTML = `
      <img src='${item.img}' alt='${item.name}'>
      <div class='cart-item-details'>
        <b>${item.name}</b><br>₹${item.price} × ${item.qty} = ₹${item.price * item.qty}
      </div>
      <div class='cart-item-controls'>
        <button onclick='changeQty(${idx}, -1)'>-</button>
        <button onclick='changeQty(${idx}, 1)'>+</button>
        <button onclick='removeFromCart(${idx})'>Remove</button>
      </div>
    `;
    cartItemsDiv.appendChild(div);
  });
  cartTotalSpan.textContent = total;
  const totalQty = cart.reduce((a,b)=>a+b.qty,0);
  cartBtn.textContent = `Cart (${totalQty} item${totalQty>1?'s':''})`;
}

function changeQty(idx, delta){
  cart[idx].qty += delta;
  if(cart[idx].qty <= 0) cart.splice(idx,1);
  updateCart();
}

function removeFromCart(idx){
  cart.splice(idx,1);
  updateCart();
}

cartBtn.addEventListener('click', () => cartModal.classList.add('open'));
closeCart.addEventListener('click', () => cartModal.classList.remove('open'));

function checkout() {
  if(cart.length === 0) return alert("Cart is empty!");
  alert(`Total amount ₹${cart.reduce((a,b)=>a+b.price*b.qty,0)}\nRedirecting to payment gateway...`);
  cart = [];
  updateCart();
  cartModal.classList.remove('open');
}

// Fetch products from backend
async function fetchProducts() {
  try {
    const res = await fetch('/api/products'); // relative URL
    products = await res.json();
    renderProducts(products);
  } catch (err) {
    console.error('Failed to fetch products:', err);
    productsDiv.innerHTML = '<p>Failed to load products.</p>';
  }
}

// Initialize
fetchProducts();
</script>
</body>
</html>

